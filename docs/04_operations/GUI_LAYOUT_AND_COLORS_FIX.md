# GUIレイアウトとカテゴリ色の修正

## 日付: 2026-01-26

## 修正内容

### 1. デフォルトノード配置の改善

**問題**: 初期ノードが重なって配置されていた

**修正後のレイアウト**:
```
[ストラテジー]  →  [モデルグループ]  →  [ルールグループ]  →  [コンディション]
   (x: 50)          (x: 280)              (x: 520)            (x: 760)
```

**詳細な配置**:

| ノード | X座標 | Y座標 | 説明 |
|--------|-------|-------|------|
| ストラテジー | 50 | 200 | 左端 |
| ロットモデル | 280 | 50 | 中央上 |
| リスクモデル | 280 | 150 | 中央 |
| エグジットモデル | 280 | 250 | 中央下 |
| ナンピンモデル | 280 | 350 | 中央最下 |
| ルールグループ | 520 | 200 | 右側中央 |
| コンディション1 (filter.spreadMax) | 760 | 80 | 右端上 |
| コンディション2 (trend.maRelation) | 760 | 200 | 右端中央 |
| コンディション3 (trigger.bbReentry) | 760 | 320 | 右端下 |

**視覚的なフロー**:
```
                    ┌─ ロットモデル (280, 50)
                    │
                    ├─ リスクモデル (280, 150)
                    │
ストラテジー (50, 200) ─┼─ エグジットモデル (280, 250)
                    │
                    ├─ ナンピンモデル (280, 350)
                    │
                    │                      ┌─ 最大スプレッド (760, 80)
                    │                      │
                    └─ ルールグループ (520, 200) ─┼─ MA上下 (760, 200)
                                           │
                                           └─ ボリンジャー回帰 (760, 320)
```

**ファイル**: `gui/src/store/useStateManager.ts`

---

### 2. カテゴリ色の追加

**問題**: カタログに存在するカテゴリ（volume, bill, osc）のCSSスタイルが未定義

**追加したカテゴリ**:

| カテゴリ | 用途 | ボーダー色 | 背景色 |
|----------|------|------------|--------|
| volume | ボリューム系インジケーター (OBV) | #2d7a4f (緑) | #e1f5ea (薄緑) |
| bill | ビル・ウィリアムズ系 (フラクタル、アリゲーター) | #c97a3e (オレンジ) | #fef0e5 (薄オレンジ) |
| osc | オシレーター系 (Force Index) | #9c4d7f (紫) | #f7e8f3 (薄紫) |

**既存のカテゴリ色** (確認済み):

| カテゴリ | 用途 | ボーダー色 | 背景色 |
|----------|------|------------|--------|
| filter | フィルター (スプレッド、ATR、標準偏差) | #2c6e63 (ティール) | #e4f1ee (薄ティール) |
| env | 環境 (時間帯、曜日) | #7a5b1c (茶色) | #f6f1e1 (薄茶) |
| trend | トレンド (MA、ADX、一目、SAR) | #4c6fa5 (青) | #edf2fb (薄青) |
| trigger | トリガー (BB、MACD、RSI、CCI等) | #b47f63 (ベージュ) | #f5e8dc (薄ベージュ) |
| lot | ロットモデル | #6b7c49 (オリーブ) | #eef2e2 (薄オリーブ) |
| risk | リスクモデル | #8b2b1a (赤茶) | #f8e1dd (薄赤) |
| exit | エグジットモデル | #73524a (茶) | #f1e9e6 (薄茶) |
| nanpin | ナンピンモデル | #7c5aa6 (紫) | #f2ebfb (薄紫) |

**ファイル**: `gui/src/styles/index.css`

---

### 3. 新規作成時のレイアウト統一

**修正**: `handleNew()`関数で、新規作成時のストラテジーノード位置を新しいレイアウトに合わせました。

**変更前**: `{ x: 80, y: 140 }`
**変更後**: `{ x: 50, y: 200 }`

**ファイル**: `gui/src/App.tsx`

---

## カタログ内のカテゴリ一覧

### コンディション系
- **filter**: スプレッド、ATR、標準偏差
- **env**: 時間帯、曜日
- **trend**: MA関係、ADX、一目、SAR
- **trigger**: BB、MACD、ストキャス、RSI、CCI、SAR反転、WPR、MFI、RVI、モメンタム、OsMA
- **volume**: OBVトレンド
- **bill**: フラクタル、アリゲーター
- **osc**: Force Index

### モデル系
- **lot**: ロット計算モデル
- **risk**: リスク管理モデル
- **exit**: エグジット戦略モデル
- **nanpin**: ナンピン戦略モデル

---

## テスト方法

### レイアウト確認
1. GUIを起動: `npm run dev` (guiディレクトリ内)
2. ビルダータブを開く
3. 初期ノードが重ならずに配置されていることを確認
4. 左から右へのフロー: ストラテジー → モデル → ルールグループ → コンディション

### カテゴリ色確認
1. パレットパネルを確認
2. 各カテゴリタブをクリック
3. 以下のカテゴリが正しい色で表示されることを確認:
   - filter (ティール)
   - env (茶色)
   - trend (青)
   - trigger (ベージュ)
   - volume (緑) ← 新規追加
   - bill (オレンジ) ← 新規追加
   - osc (紫) ← 新規追加
   - lot (オリーブ)
   - risk (赤茶)
   - exit (茶)
   - nanpin (紫)

### 新規作成確認
1. "新規"ボタンをクリック
2. ストラテジーノードが (50, 200) に配置されることを確認
3. 他のノードを追加して、レイアウトが崩れないことを確認

---

## 変更ファイル

1. `gui/src/store/useStateManager.ts` - initialNodesの配置変更
2. `gui/src/styles/index.css` - volume, bill, oscカテゴリのスタイル追加
3. `gui/src/App.tsx` - handleNew()の初期位置変更

---

## 今後の改善案

1. **自動レイアウト**: ノード追加時に自動的に適切な位置に配置
2. **グリッドスナップ**: ノードをグリッドに吸着させる機能
3. **レイアウトテンプレート**: よく使うレイアウトをテンプレート化
4. **ズーム調整**: 初期表示時のズームレベルを最適化
5. **カテゴリアイコン**: 各カテゴリに視覚的なアイコンを追加
